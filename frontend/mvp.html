<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drone Detection Dashboard – MVP</title>

  <!-- Bootstrap 5 CSS (Replace with local copy if preferred) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <style>
    /* Minimal custom styling */
    .sensor-card.online   { border-left: 6px solid #28a745; }  /* green  */
    .sensor-card.offline  { border-left: 6px solid #dc3545; }  /* red    */
    .sensor-card {
      background:#f8f9fa;border:1px solid #ced4da;border-radius:.5rem;
      padding:1rem;margin-bottom:1rem;
    }
    /* keep table header visible on small screens */
    .table-responsive { max-height: 60vh; overflow-y:auto; }
  </style>
</head>

<body class="p-4 bg-light">

  <div class="container-xl">
    <h1 class="mb-4">Drone Detection Dashboard – MVP</h1>

    <!-- 1) SENSOR STATUS GRID -->
    <div id="sensorGrid" class="row gy-4 mb-5">
      <!-- Cards injected via JS -->
    </div>

    <!-- 2) DETECTION FEED -->
    <h2 class="mb-3">Live Drone Detections</h2>
    <div class="table-responsive">
      <table id="detectionTable" class="table table-striped table-sm align-middle">
        <thead class="table-dark position-sticky top-0">
          <tr>
            <th scope="col">Time&nbsp;(local)</th>
            <th scope="col">Sensor ID</th>
            <th scope="col">RSSI&nbsp;(dBm)</th>
            <th scope="col">Freq&nbsp;(GHz)</th>
            <th scope="col">Confidence</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows injected via JS -->
        </tbody>
      </table>
    </div>
  </div>


  <!-- Bootstrap 5 Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /* =========  MOCK DATA & HELPERS  ========= */

    // --- static sensor list (one Pi for now) ---
    const sensors = [
      {
        id: "sensor-001",
        location: "Syracuse HQ Roof",
        signalStrength: 82,
        lastSeen: new Date().toISOString(),
        status: "online"
      }
    ];

    // --- util: generate ISO timestamp X seconds ago ---
    function ago(sec) { return new Date(Date.now() - sec*1000).toISOString(); }

    // --- util: random within [min,max] ---
    const rand = (min, max) => Math.random() * (max - min) + min;

    // --- create a mock detection object ---
    function mockDetection() {
      return {
        detectedAt: new Date().toISOString(),
        sensorId: "sensor-001",
        rssi: Math.round(rand(-95, -35)),           // dBm
        freq: (rand(2.4, 5.9)).toFixed(2),          // GHz
        confidence: (rand(0.6, 0.97)).toFixed(2)    // 0-1
      };
    }

    /* =========  RENDER SENSOR CARDS  ========= */
    const grid = document.getElementById("sensorGrid");

    function renderSensors() {
      grid.innerHTML = "";                       // clear grid
      sensors.forEach(s => {
        const card = document.createElement("div");
        card.className = "col-12 col-md-6 col-lg-4";
        card.innerHTML = `
          <div class="sensor-card ${s.status}">
            <h5 class="mb-1">${s.location}</h5>
            <p class="mb-1"><strong>ID:</strong> ${s.id}</p>
            <p class="mb-1"><strong>Signal:</strong> ${s.signalStrength}%</p>
            <p class="mb-1"><strong>Last&nbsp;Seen:</strong> ${new Date(s.lastSeen).toLocaleString()}</p>
            <p class="mb-0"><strong>Status:</strong> <span class="text-${s.status==='online'?'success':'danger'}">${s.status}</span></p>
          </div>`;
        grid.appendChild(card);
      });
    }

    /* =========  RENDER DETECTIONS  ========= */
    const tableBody = document.querySelector("#detectionTable tbody");

    function prependDetectionRow(det) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${new Date(det.detectedAt).toLocaleTimeString()}</td>
        <td>${det.sensorId}</td>
        <td>${det.rssi}</td>
        <td>${det.freq}</td>
        <td>${(det.confidence*100).toFixed(0)}%</td>
      `;
      // put newest on top
      tableBody.prepend(row);
      // keep only latest 100 rows
      if (tableBody.rows.length > 100) tableBody.deleteRow(-1);
    }

    /* =========  INITIALIZE DASHBOARD  ========= */
    renderSensors();

    // push a new mock detection every 5 seconds
    setInterval(() => {
      const detection = mockDetection();
      prependDetectionRow(detection);
      // update sensor's lastSeen & signalStrength
      const s = sensors.find(x => x.id === detection.sensorId);
      if (s) {
        s.lastSeen = detection.detectedAt;
        s.signalStrength = Math.min(100, Math.max(0, s.signalStrength + Math.round(rand(-3, 3))));
      }
      renderSensors();
    }, 5000);
  </script>
</body>
</html>
